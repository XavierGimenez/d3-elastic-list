/*! elastic-list 2015-02-12 */
!function(){var a,b,c,d,e,f,g,h=["country","gender","year","category","city","name"],i={},j=25,k=40,l=35,m="4px";g=d3.select("#mytooltip").style("visibility","hidden").style("background-color","#333333"),h.forEach(function(a){i[a]={},i[a].values={},i[a].filters=d3.set()});var n=function(b,c){console.log(c.length+" documents"),a=c,a.forEach(function(a){a.__filtered__=!0,h.forEach(function(b){""!=a[b]&&(a[b]in i[b].values?i[b].values[a[b]]++:i[b].values[a[b]]=1)})}),r()},o=function(a,b){if(i[a].filters.has(b)?i[a].filters.remove(b):i[a].filters.add(b),p()){for(var c=[],d=0;d<h.length;d++)c=c.concat(i[h[d]].filters.values());d3.select(".elastic-list-filters").select("p").text("Filtering by: "+c.toString())}else d3.select(".elastic-list-filters").select("p").text("No filters applied");q()},p=function(){for(var a=!1,b=0;b<h.length&&0==a;b++)a=a||!i[h[b]].filters.empty();return a},q=function(){h.forEach(function(a){d3.keys(i[a].values).forEach(function(b){i[a].values[b]=0})}),a.forEach(p()?function(a){a.__filtered__=!0;for(var b=0;b<h.length&&1==a.__filtered__;b++)i[h[b]].filters.empty()||(a.__filtered__=a.__filtered__&&i[h[b]].filters.has(a[h[b]]));1==a.__filtered__&&h.forEach(function(b){i[b].values[a[b]]++})}:function(a){a.__filtered__=!0,h.forEach(function(b){i[b].values[a[b]]++})}),t()},r=function(){e={top:20,right:20,bottom:30,left:40},width=1170-e.left-e.right,height=400-e.top-e.bottom+k,value_cell_padding=1,value_cell_height=37,d=d3.scale.ordinal().domain(h).rangeRoundBands([0,width]),c=d3.svg.axis().scale(d).orient("bottom"),b=d3.select("#elastic-list").attr("class","elastic-list").style("width",width+"px").style("height",height+"px"),b.append("div").attr("class","elastic-list-dimension-headers").selectAll(".elastic-list-dimension-header").data(h).enter().append("div").attr("class","elastic-list-dimension-header").style("width",d.rangeBand()+"px").style("height",k+"px").text(function(a){return a.capitalize()}),d3.select("#filtering").append("div").attr("class","elastic-list-filters").style("height",j).append("p").text("No filters applied"),d3.select("#results").style("width",width+"px"),t()},s=function(a,b){var c=a.attributes.__minvalue__.value;return 0==b.value?m:value_cell_height+b.value/c+"px"},t=function(){var c=1e3,e=function(a){return d3.min(d3.values(a.value.values).filter(function(a){return a>0}))},h=function(a){return d3.entries(a.value.values)};f=b.selectAll(".elastic-list-dimension").data(d3.entries(i)),f.attr("__minvalue__",e),f.selectAll(".elastic-list-dimension-item").data(h).transition().duration(c).style("height",function(a){return s(this.parentNode,a)}).style("top",function(a,b){return(value_cell_height+value_cell_padding)*b+"px"});var j=f.enter().append("div").attr("class","elastic-list-dimension").style("width",d.rangeBand()+"px").style("height",height-k+"px").attr("__minvalue__",e).selectAll(".elastic-list-dimension-item").data(h);j.enter().append("div").attr("class","elastic-list-dimension-item").style("height",function(a){return s(this.parentNode,a)}).style("width",d.rangeBand()+"px").style("left",0).style("top",function(a,b){return(value_cell_height+value_cell_padding)*b+"px"}).on("mouseover",function(a){0==a.value?g.html(a.key+": no matchings").style("visibility","visible"):d3.select(this).text().indexOf("...")>-1&&g.html(a.key+": "+a.value).style("visibility","visible"),d3.select(this).classed("elastic-list-dimension-item-hover",!0)}).on("mousemove",function(a){(0==a.value||d3.select(this).text().indexOf("...")>-1)&&g.style("top",d3.event.pageY-20+"px").style("left",d3.event.pageX+5+"px")}).on("mouseout",function(){g.style("visibility","hidden"),d3.select(this).classed("elastic-list-dimension-item-hover",!1)}).on("click",function(a){g.style("visibility","hidden"),o(this.parentNode.__data__.key,a.key),d3.select(this).classed("elastic-list-dimension-item-hover",!1),d3.select(this).classed("filter",function(a){return i[this.parentNode.__data__.key].filters.has(a.key)})}),items=b.selectAll(".elastic-list-dimension-item"),items.each(function(a){d3.select(this).selectAll("p").remove(),a.value>0&&(d3.select(this).append("p").html(a.key.length>l?a.key.substring(0,l)+"...":a.key).style("opacity",0).attr("class","key").transition().duration(c).delay(200).style("opacity",1),d3.select(this).append("p").html("<b>"+a.value+"</b>").style("opacity",0).attr("class","value").transition().duration(c).delay(200).style("opacity",1))});var m="";a.forEach(function(a){a.__filtered__&&(m+="<p>"+a.year+" - <b>"+a.firstname+" "+a.surname+". </b>"+a.category.capitalize()+", "+a.country+"<span class='price-motivation'> "+a.motivation+"</span></p>")}),d3.select("#results").html(m),d3.select("#results-count").html("Found "+d3.select("#results").selectAll("p")[0].length)};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},d3.csv("nobel_prizes.csv",n)}();